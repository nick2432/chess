export const DROP_EFFECTS = ["move", "copy", "link"];
export const CUSTOM_MIME_TYPE = "application/x-dnd";
export const JSON_MIME_TYPE = "application/json";
export const MSIE_MIME_TYPE = "Text";
function mimeTypeIsCustom(mimeType) {
    return mimeType.substr(0, CUSTOM_MIME_TYPE.length) === CUSTOM_MIME_TYPE;
}
export function getWellKnownMimeType(event) {
    if (event.dataTransfer) {
        const types = event.dataTransfer.types;
        // IE 9 workaround.
        if (!types) {
            return MSIE_MIME_TYPE;
        }
        for (let i = 0; i < types.length; i++) {
            if (types[i] === MSIE_MIME_TYPE
                || types[i] === JSON_MIME_TYPE
                || mimeTypeIsCustom(types[i])) {
                return types[i];
            }
        }
    }
    return null;
}
export function setDragData(event, data, effectAllowed) {
    // Internet Explorer and Microsoft Edge don't support custom mime types, see design doc:
    // https://github.com/marceljuenemann/angular-drag-and-drop-lists/wiki/Data-Transfer-Design
    const mimeType = CUSTOM_MIME_TYPE + (data.type ? ("-" + data.type) : "");
    const dataString = JSON.stringify(data);
    try {
        event.dataTransfer?.setData(mimeType, dataString);
    }
    catch (e) {
        //   Setting a custom MIME type did not work, we are probably in IE or Edge.
        try {
            event.dataTransfer?.setData(JSON_MIME_TYPE, dataString);
        }
        catch (e) {
            //   We are in Internet Explorer and can only use the Text MIME type. Also note that IE
            //   does not allow changing the cursor in the dragover event, therefore we have to choose
            //   the one we want to display now by setting effectAllowed.
            const effectsAllowed = filterEffects(DROP_EFFECTS, effectAllowed);
            if (event.dataTransfer) {
                event.dataTransfer.effectAllowed = effectsAllowed[0];
            }
            event.dataTransfer?.setData(MSIE_MIME_TYPE, dataString);
        }
    }
}
export function getDropData(event, dragIsExternal) {
    // check if the mime type is well known
    const mimeType = getWellKnownMimeType(event);
    // drag did not originate from [dndDraggable]
    if (dragIsExternal === true) {
        if (mimeType !== null
            && mimeTypeIsCustom(mimeType)) {
            // the type of content is well known and safe to handle
            return JSON.parse(event.dataTransfer?.getData(mimeType) ?? "{}");
        }
        // the contained data is unknown, let user handle it
        return {};
    }
    if (mimeType !== null) {
        // the type of content is well known and safe to handle
        return JSON.parse(event.dataTransfer?.getData(mimeType) ?? "{}");
    }
    // the contained data is unknown, let user handle it
    return {};
}
export function filterEffects(effects, allowed) {
    if (allowed === "all"
        || allowed === "uninitialized") {
        return effects;
    }
    return effects.filter(function (effect) {
        return allowed.toLowerCase().indexOf(effect) !== -1;
    });
}
export function getDirectChildElement(parentElement, childElement) {
    let directChild = childElement;
    while (directChild.parentNode !== parentElement) {
        // reached root node without finding given parent
        if (!directChild.parentNode) {
            return null;
        }
        directChild = directChild.parentNode;
    }
    return directChild;
}
export function shouldPositionPlaceholderBeforeElement(event, element, horizontal) {
    const bounds = element.getBoundingClientRect();
    // If the pointer is in the upper half of the list item element,
    // we position the placeholder before the list item, otherwise after it.
    if (horizontal) {
        return (event.clientX < bounds.left + bounds.width / 2);
    }
    return (event.clientY < bounds.top + bounds.height / 2);
}
export function calculateDragImageOffset(event, dragImage) {
    const dragImageComputedStyle = window.getComputedStyle(dragImage);
    const paddingTop = parseFloat(dragImageComputedStyle.paddingTop) || 0;
    const paddingLeft = parseFloat(dragImageComputedStyle.paddingLeft) || 0;
    const borderTop = parseFloat(dragImageComputedStyle.borderTopWidth) || 0;
    const borderLeft = parseFloat(dragImageComputedStyle.borderLeftWidth) || 0;
    return {
        x: event.offsetX + paddingLeft + borderLeft,
        y: event.offsetY + paddingTop + borderTop
    };
}
export function setDragImage(event, dragImage, offsetFunction) {
    const offset = offsetFunction(event, dragImage) || { x: 0, y: 0 };
    event.dataTransfer.setDragImage(dragImage, offset.x, offset.y);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG5kLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZG5kL3NyYy9saWIvZG5kLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWNBLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFrQixDQUFDO0FBRXZFLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDO0FBQ3BELE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxrQkFBa0IsQ0FBQztBQUNqRCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDO0FBRXJDLFNBQVMsZ0JBQWdCLENBQUUsUUFBZTtJQUV4QyxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUUsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLE1BQU0sQ0FBRSxLQUFLLGdCQUFnQixDQUFDO0FBQzVFLENBQUM7QUFFRCxNQUFNLFVBQVUsb0JBQW9CLENBQUUsS0FBZTtJQUVuRCxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUc7UUFFdkIsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7UUFFdkMsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxLQUFLLEVBQUc7WUFFWCxPQUFPLGNBQWMsQ0FBQztTQUN2QjtRQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFHO1lBRXRDLElBQUksS0FBSyxDQUFFLENBQUMsQ0FBRSxLQUFLLGNBQWM7bUJBQzVCLEtBQUssQ0FBRSxDQUFDLENBQUUsS0FBSyxjQUFjO21CQUM3QixnQkFBZ0IsQ0FBRSxLQUFLLENBQUUsQ0FBQyxDQUFFLENBQUUsRUFBRztnQkFFcEMsT0FBTyxLQUFLLENBQUUsQ0FBQyxDQUFFLENBQUM7YUFDbkI7U0FDRjtLQUNGO0lBRUQsT0FB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VUFBVSxZQUFZLENBQUUsS0FBZSxFQUFFLFNBQWlCLEVBQUUsY0FBeUM7SUFFekcsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFFLEtBQUssRUFBRSxTQUFTLENBQUUsSUFBSSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDO0lBRWpFLEtBQUssQ0FBQyxZQUFvQixDQUFDLFlBQVksQ0FBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFFLENBQUM7QUFDNUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERyb3BFZmZlY3QsIEVmZmVjdEFsbG93ZWQgfSBmcm9tIFwiLi9kbmQtdHlwZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBEcmFnRHJvcERhdGEge1xuICBkYXRhPzphbnk7XG4gIHR5cGU/OnN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEbmRFdmVudCBleHRlbmRzIERyYWdFdmVudCB7XG4gIF9kbmRVc2luZ0hhbmRsZT86Ym9vbGVhbjtcbiAgX2RuZERyb3B6b25lQWN0aXZlPzp0cnVlO1xufVxuXG5leHBvcnQgdHlwZSBEbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbiA9ICggZXZlbnQ6RHJhZ0V2ZW50LCBkcmFnSW1hZ2U6RWxlbWVudCApID0+IHsgeDpudW1iZXIsIHk6bnVtYmVyIH07XG5cbmV4cG9ydCBjb25zdCBEUk9QX0VGRkVDVFMgPSBbIFwibW92ZVwiLCBcImNvcHlcIiwgXCJsaW5rXCIgXSBhcyBEcm9wRWZmZWN0W107XG5cbmV4cG9ydCBjb25zdCBDVVNUT01fTUlNRV9UWVBFID0gXCJhcHBsaWNhdGlvbi94LWRuZFwiO1xuZXhwb3J0IGNvbnN0IEpTT05fTUlNRV9UWVBFID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XG5leHBvcnQgY29uc3QgTVNJRV9NSU1FX1RZUEUgPSBcIlRleHRcIjtcblxuZnVuY3Rpb24gbWltZVR5cGVJc0N1c3RvbSggbWltZVR5cGU6c3RyaW5nICkge1xuXG4gIHJldHVybiBtaW1lVHlwZS5zdWJzdHIoIDAsIENVU1RPTV9NSU1FX1RZUEUubGVuZ3RoICkgPT09IENVU1RPTV9NSU1FX1RZUEU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRXZWxsS25vd25NaW1lVHlwZSggZXZlbnQ6RHJhZ0V2ZW50ICk6c3RyaW5nIHwgbnVsbCB7XG5cbiAgaWYoIGV2ZW50LmRhdGFUcmFuc2ZlciApIHtcblxuICAgIGNvbnN0IHR5cGVzID0gZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzO1xuXG4gICAgLy8gSUUgOSB3b3JrYXJvdW5kLlxuICAgIGlmKCAhdHlwZXMgKSB7XG5cbiAgICAgIHJldHVybiBNU0lFX01JTUVfVFlQRTtcbiAgICB9XG5cbiAgICBmb3IoIGxldCBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrICkge1xuXG4gICAgICBpZiggdHlwZXNbIGkgXSA9PT0gTVNJRV9NSU1FX1RZUEVcbiAgICAgICAgfHwgdHlwZXNbIGkgXSA9PT0gSlNPTl9NSU1FX1RZUEVcbiAgICAgICAgfHwgbWltZVR5cGVJc0N1c3RvbSggdHlwZXNbIGkgXSApICkge1xuXG4gICAgICAgIHJldHVybiB0eXBlc1sgaSBdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RHJhZ0RhdGEoIGV2ZW50OkRyYWdFdmVudCwgZGF0YTpEcmFnRHJvcERhdGEsIGVmZmVjdEFsbG93ZWQ6RWZmZWN0QWxsb3dlZCApOnZvaWQge1xuXG4gIC8vIEludGVybmV0IEV4cGxvcmVyIGFuZCBNaWNyb3NvZnQgRWRnZSBkb24ndCBzdXBwb3J0IGN1c3RvbSBtaW1lIHR5cGVzLCBzZWUgZGVzaWduIGRvYzpcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21hcmNlbGp1ZW5lbWFubi9hbmd1bGFyLWRyYWctYW5kLWRyb3AtbGlzdHMvd2lraS9EYXRhLVRyYW5zZmVyLURlc2lnblxuICBjb25zdCBtaW1lVHlwZSA9IENVU1RPTV9NSU1FX1RZUEUgKyAoZGF0YS50eXBlID8gKFwiLVwiICsgZGF0YS50eXBlKSA6IFwiXCIpO1xuXG4gIGNvbnN0IGRhdGFTdHJpbmcgPSBKU09OLnN0cmluZ2lmeSggZGF0YSApO1xuXG4gIHRyeSB7XG5cbiAgICBldmVudC5kYXRhVHJhbnNmZXI/LnNldERhdGEoIG1pbWVUeXBlLCBkYXRhU3RyaW5nICk7XG5cbiAgfVxuICBjYXRjaCggZSApIHtcblxuICAgIC8vICAgU2V0dGluZyBhIGN1c3RvbSBNSU1FIHR5cGUgZGlkIG5vdCB3b3JrLCB3ZSBhcmUgcHJvYmFibHkgaW4gSUUgb3IgRWRnZS5cbiAgICB0cnkge1xuXG4gICAgICBldmVudC5kYXRhVHJhbnNmZXI/LnNldERhdGEoIEpTT05fTUlNRV9UWVBFLCBkYXRhU3RyaW5nICk7XG5cbiAgICB9XG4gICAgY2F0Y2goIGUgKSB7XG5cbiAgICAgIC8vICAgV2UgYXJlIGluIEludGVybmV0IEV4cGxvcmVyIGFuZCBjYW4gb25seSB1c2UgdGhlIFRleHQgTUlNRSB0eXBlLiBBbHNvIG5vdGUgdGhhdCBJRVxuICAgICAgLy8gICBkb2VzIG5vdCBhbGxvdyBjaGFuZ2luZyB0aGUgY3Vyc29yIGluIHRoZSBkcmFnb3ZlciBldmVudCwgdGhlcmVmb3JlIHdlIGhhdmUgdG8gY2hvb3NlXG4gICAgICAvLyAgIHRoZSBvbmUgd2Ugd2FudCB0byBkaXNwbGF5IG5vdyBieSBzZXR0aW5nIGVmZmVjdEFsbG93ZWQuXG4gICAgICBjb25zdCBlZmZlY3RzQWxsb3dlZCA9IGZpbHRlckVmZmVjdHMoIERST1BfRUZGRUNUUywgZWZmZWN0QWxsb3dlZCApO1xuICAgICAgaWYoZXZlbnQuZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gZWZmZWN0c0FsbG93ZWRbIDAgXTtcbiAgICAgIH1cblxuICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyPy5zZXREYXRhKCBNU0lFX01JTUVfVFlQRSwgZGF0YVN0cmluZyApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RHJvcERhdGEoIGV2ZW50OkRyYWdFdmVudCwgZHJhZ0lzRXh0ZXJuYWw6Ym9vbGVhbiApOkRyYWdEcm9wRGF0YSB7XG5cbiAgLy8gY2hlY2sgaWYgdGhlIG1pbWUgdHlwZSBpcyB3ZWxsIGtub3duXG4gIGNvbnN0IG1pbWVUeXBlID0gZ2V0V2VsbEtub3duTWltZVR5cGUoIGV2ZW50ICk7XG5cbiAgLy8gZHJhZyBkaWQgbm90IG9yaWdpbmF0ZSBmcm9tIFtkbmREcmFnZ2FibGVdXG4gIGlmKCBkcmFnSXNFeHRlcm5hbCA9PT0gdHJ1ZSApIHtcblxuICAgIGlmKCBtaW1lVHlwZSAhPT0gbnVsbFxuICAgICAgJiYgbWltZVR5cGVJc0N1c3RvbSggbWltZVR5cGUgKSApIHtcblxuICAgICAgLy8gdGhlIHR5cGUgb2YgY29udGVudCBpcyB3ZWxsIGtub3duIGFuZCBzYWZlIHRvIGhhbmRsZVxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoIGV2ZW50LmRhdGFUcmFuc2Zlcj8uZ2V0RGF0YSggbWltZVR5cGUgKSA/PyBcInt9XCIgKTtcbiAgICB9XG5cbiAgICAvLyB0aGUgY29udGFpbmVkIGRhdGEgaXMgdW5rbm93biwgbGV0IHVzZXIgaGFuZGxlIGl0XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgaWYobWltZVR5cGUgIT09IG51bGwpIHtcbiAgICAvLyB0aGUgdHlwZSBvZiBjb250ZW50IGlzIHdlbGwga25vd24gYW5kIHNhZmUgdG8gaGFuZGxlXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoIGV2ZW50LmRhdGFUcmFuc2Zlcj8uZ2V0RGF0YSggbWltZVR5cGUgKSA/PyBcInt9XCIgKTtcbiAgfVxuXG4gIC8vIHRoZSBjb250YWluZWQgZGF0YSBpcyB1bmtub3duLCBsZXQgdXNlciBoYW5kbGUgaXRcbiAgcmV0dXJuIHt9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyRWZmZWN0cyggZWZmZWN0czpEcm9wRWZmZWN0W10sIGFsbG93ZWQ6RWZmZWN0QWxsb3dlZCB8IERyb3BFZmZlY3QgKTpEcm9wRWZmZWN0W10ge1xuXG4gIGlmKCBhbGxvd2VkID09PSBcImFsbFwiXG4gICAgfHwgYWxsb3dlZCA9PT0gXCJ1bmluaXRpYWxpemVkXCIgKSB7XG5cbiAgICByZXR1cm4gZWZmZWN0cztcbiAgfVxuXG4gIHJldHVybiBlZmZlY3RzLmZpbHRlciggZnVuY3Rpb24oIGVmZmVjdCApIHtcblxuICAgIHJldHVybiBhbGxvd2VkLnRvTG93ZXJDYXNlKCkuaW5kZXhPZiggZWZmZWN0ICkgIT09IC0xO1xuICB9ICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREaXJlY3RDaGlsZEVsZW1lbnQoIHBhcmVudEVsZW1lbnQ6RWxlbWVudCwgY2hpbGRFbGVtZW50OkVsZW1lbnQgKTpFbGVtZW50IHwgbnVsbCB7XG5cbiAgbGV0IGRpcmVjdENoaWxkOk5vZGUgPSBjaGlsZEVsZW1lbnQ7XG5cbiAgd2hpbGUoIGRpcmVjdENoaWxkLnBhcmVudE5vZGUgIT09IHBhcmVudEVsZW1lbnQgKSB7XG5cbiAgICAvLyByZWFjaGVkIHJvb3Qgbm9kZSB3aXRob3V0IGZpbmRpbmcgZ2l2ZW4gcGFyZW50XG4gICAgaWYoICFkaXJlY3RDaGlsZC5wYXJlbnROb2RlICkge1xuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBkaXJlY3RDaGlsZCA9IGRpcmVjdENoaWxkLnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gZGlyZWN0Q2hpbGQgYXMgRWxlbWVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZFBvc2l0aW9uUGxhY2Vob2xkZXJCZWZvcmVFbGVtZW50KCBldmVudDpEcmFnRXZlbnQsIGVsZW1lbnQ6RWxlbWVudCwgaG9yaXpvbnRhbDpib29sZWFuICkge1xuXG4gIGNvbnN0IGJvdW5kcyA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgLy8gSWYgdGhlIHBvaW50ZXIgaXMgaW4gdGhlIHVwcGVyIGhhbGYgb2YgdGhlIGxpc3QgaXRlbSBlbGVtZW50LFxuICAvLyB3ZSBwb3NpdGlvbiB0aGUgcGxhY2Vob2xkZXIgYmVmb3JlIHRoZSBsaXN0IGl0ZW0sIG90aGVyd2lzZSBhZnRlciBpdC5cbiAgaWYoIGhvcml6b250YWwgKSB7XG5cbiAgICByZXR1cm4gKGV2ZW50LmNsaWVudFggPCBib3VuZHMubGVmdCArIGJvdW5kcy53aWR0aCAvIDIpO1xuICB9XG5cbiAgcmV0dXJuIChldmVudC5jbGllbnRZIDwgYm91bmRzLnRvcCArIGJvdW5kcy5oZWlnaHQgLyAyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZURyYWdJbWFnZU9mZnNldCggZXZlbnQ6RHJhZ0V2ZW50LCBkcmFnSW1hZ2U6RWxlbWVudCApOnsgeDpudW1iZXIsIHk6bnVtYmVyIH0ge1xuXG4gIGNvbnN0IGRyYWdJbWFnZUNvbXB1dGVkU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZHJhZ0ltYWdlICk7XG4gIGNvbnN0IHBhZGRpbmdUb3AgPSBwYXJzZUZsb2F0KCBkcmFnSW1hZ2VDb21wdXRlZFN0eWxlLnBhZGRpbmdUb3AgKSB8fCAwO1xuICBjb25zdCBwYWRkaW5nTGVmdCA9IHBhcnNlRmxvYXQoIGRyYWdJbWFnZUNvbXB1dGVkU3R5bGUucGFkZGluZ0xlZnQgKSB8fCAwO1xuICBjb25zdCBib3JkZXJUb3AgPSBwYXJzZUZsb2F0KCBkcmFnSW1hZ2VDb21wdXRlZFN0eWxlLmJvcmRlclRvcFdpZHRoICkgfHwgMDtcbiAgY29uc3QgYm9yZGVyTGVmdCA9IHBhcnNlRmxvYXQoIGRyYWdJbWFnZUNvbXB1dGVkU3R5bGUuYm9yZGVyTGVmdFdpZHRoICkgfHwgMDtcblxuICByZXR1cm4ge1xuICAgIHg6IGV2ZW50Lm9mZnNldFggKyBwYWRkaW5nTGVmdCArIGJvcmRlckxlZnQsXG4gICAgeTogZXZlbnQub2Zmc2V0WSArIHBhZGRpbmdUb3AgKyBib3JkZXJUb3BcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERyYWdJbWFnZSggZXZlbnQ6RHJhZ0V2ZW50LCBkcmFnSW1hZ2U6RWxlbWVudCwgb2Zmc2V0RnVuY3Rpb246RG5kRHJhZ0ltYWdlT2Zmc2V0RnVuY3Rpb24gKTp2b2lkIHtcblxuICBjb25zdCBvZmZzZXQgPSBvZmZzZXRGdW5jdGlvbiggZXZlbnQsIGRyYWdJbWFnZSApIHx8IHt4OiAwLCB5OiAwfTtcblxuICAoZXZlbnQuZGF0YVRyYW5zZmVyIGFzIGFueSkuc2V0RHJhZ0ltYWdlKCBkcmFnSW1hZ2UsIG9mZnNldC54LCBvZmZzZXQueSApO1xufVxuIl19